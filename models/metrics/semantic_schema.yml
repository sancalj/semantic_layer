version: 2 

semantic_models:
## MODEL #1
  - name: attrition_rate
    model: ref('mtr_attrition_rate')
    description: "Semantic model including data from all employees who left the company."
    defaults:
      agg_time_dimension: termination_date

    entities:
      - name: employee  
        type: primary
        expr: employee_id 

      - name: depto
        type: foreign
        expr: deparment

      - name: role
        type: foreign
        expr: role

      - name: gender
        type: foreign
        expr: gender

    dimensions: 
      - name: termination_date
        type: time
        type_params:
          time_granularity: day 

    measures:
      - name: total_attrition
        description: "Total attrition reported"
        agg: percentile
        agg_params:
          percentile: .99
          use_discrete_percentile: False

## MODEL #2 
  - name: job_satisfaction_by_role
    model: ref('mtr_job_satisfaction_by_role') 
    description: "Model created to analyze job satisfaction segregated by role, and it relation with attrition."
    defaults:
      agg_time_dimension: termination_date

    entities:
      - name: employee_id
        type: primary
        expr: employee_id

    dimensions:
      - name: hire_date
        type: time
        expr: hire_date
        type_params:
          time_granularity: day

      - name: termination_date 
        type: time
        expr: termination_Date
        type_params:
          time_granularity: day
      
      - name: attrition
        type: categorical
    
    measures: 
      - name: total_emp
        description: Total count of employees
        expr: employee_id
        agg: count_distinct

## MODEL #3
  - name: work_profile
    model: ref('stg_work_profile')
    description: " Contains all data relataed with performance, and working and education profiling."

    entities:
      - name: emp_id
        type: primary
        expr: employee_id

    dimensions: 
      - name: job_role
        type: categorical

##========##
## Metrics ##
##========##

# metrics for attrition_rate #
metrics: 
  - name: total_emp 
    description: Total count of employees. 
    type: simple
    label: Total count of Employees
    type_params:
      measure:
        name: total_emp
        fill_nulls_with: 0 
        join_to_timespine: true

  - name: attrition_by_department
    description: total attrition
    type: simple # Pointers to a measure created in a semantic model
    label: Attrition by department
    type_params:
      measure: 
        name: total_attrition # The measure creating a proxy of.
        fill_nulls_with: 0 
        join_to_timespine: true
    filter: |
      {{ Metric('total_attrition', group_by = ['department']) }}

  - name: attrition_by_gender
    description: total attrition
    type: simple 
    label: Attrition by Gender
    type_params:
      measure: 
        name: total_attrition 
        fill_nulls_with: 0 
        join_to_timespine: true
    filter: |
      {{ Metric('total_attrition', group_by = ['gender']) }}

  - name: attrition_by_role
    description: total attrition
    type: simple 
    label: Attrition by role
    type_params:
      measure: 
        name: total_attrition 
        fill_nulls_with: 0 
        join_to_timespine: true
    filter: |
      {{ Metric('total_attrition', group_by = ['role']) }}
    
# metrics for working profile # 



